<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pr√≥ximas Salidas</title>

<style>
:root{--verde:#1a4b27;--bg:#f4f4f4}
body{margin:0;font-family:Arial;background:var(--bg)}
header{background:var(--verde);color:#fff;text-align:center;font-weight:bold;padding:18px}
.container{max-width:900px;margin:auto;padding:15px}
.card{background:#fff;border-radius:12px;padding:12px;box-shadow:0 2px 6px rgba(0,0,0,.06);margin-bottom:10px}
.asignada{border-left:6px solid green}
.pend{color:#c1121f;font-weight:bold}
.obs{margin-top:6px;font-style:italic;background:#f7f7f7;padding:6px;border-left:4px solid var(--verde)}
.etiqueta{background:#cfffcf;padding:4px 8px;border-radius:6px;font-size:12px;margin-right:6px}
.back{position:fixed;left:15px;bottom:15px}
button{background:#c1121f;color:#fff;border:none;padding:6px 10px;border-radius:8px;font-weight:bold;cursor:pointer}
</style>
</head>

<body>
<header>üìÖ Pr√≥ximas Salidas de Predicaci√≥n</header>

<div class="container" id="lista"></div>

<button class="back" onclick="location.href='index.html'">‚¨Ö Volver</button>

<script type="module">
import { db, ref, onValue } from "./firebase.js";

const lista = document.getElementById("lista");
const salidasRef = ref(db,"salidas_asignadas");

/* --- BLOQUEO TOTAL INVITADOS --- */
const rol = localStorage.getItem("rol");
if(rol !== "admin" && rol !== "conductor"){
  document.body.innerHTML = "<h2 style='text-align:center;margin-top:40px'>‚õî Acceso restringido</h2>";
  throw new Error("Sin permiso");
}

/* SOLO MUESTRA SALIDAS ASIGNADAS */
onValue(salidasRef, snap=>{
  lista.innerHTML = "";
  snap.forEach(x=>{
    const s = x.val();

    const card = document.createElement("div");
    card.className="card asignada";

    card.innerHTML = `
      <span class="etiqueta">ASIGNADA</span>
      <b>Territorio ${s.territorio||"-"}</b>
      <div>üìÖ Fecha: ${s.fecha||"-"}</div>
      <div>üë§ Conductor: ${s.conductor||"-"}</div>
      <div>üìç Punto de encuentro: ${s.calle||"-"} / ${s.interseccion||"-"}</div>
      <div>üß± Pendientes: <span class="pend">${(s.pendientes||[]).join(", ")}</span></div>
      ${s.observaciones?`<div class="obs">${s.observaciones}</div>`:""}
    `;

    lista.appendChild(card);
  });
});
</script>

</body>
</html>