import React, { useEffect, useState } from "react";

// TerritoriosApp ‚Äî Single-file React preview (inline styles)
// - Dise√±o tipo tarjetas grandes
// - Animaciones suaves tipo iOS/Android
// - Modo claro/oscuro real
// - Componentes accesibles y pensados para personas mayores
// - Listo para integrarse en un proyecto React y desplegar en GitHub Pages

export default function TerritoriosApp() {
  const [view, setView] = useState("home"); // home | tablero | reportar | mapa | sugerencias | settings
  const [dark, setDark] = useState(false);
  const [name, setName] = useState("");
  const [lastReports, setLastReports] = useState([]); // {territorio,manzana,name,date}

  useEffect(() => {
    document.documentElement.style.background = dark ? "#0f1724" : "#f4fbf4";
    document.documentElement.style.color = dark ? "#e6eef0" : "#07202b";
  }, [dark]);

  function enviarReporte({ territorio, manzana, nombre }) {
    const r = { territorio, manzana, nombre: nombre || "An√≥nimo", date: new Date().toISOString() };
    setLastReports(prev => [r, ...prev].slice(0, 10));
    // Simula notificaci√≥n WhatsApp: abrir link
    const admin = "+543416715020";
    const wa = `https://wa.me/${admin.replace(/\D/g,"")}?text=${encodeURIComponent(`${r.nombre} report√≥ Territorio ${territorio}, manzana ${manzana}`)}`;
    window.open(wa, "_blank");
    setTimeout(() => setView("tablero"), 700);
  }

  return (
    <div style={{ minHeight: "100vh", padding: 20, fontFamily: "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial" }}>
      <Header dark={dark} setDark={setDark} />

      <main style={{ maxWidth: 1100, margin: "18px auto" }}>
        {view === "home" && (
          <HomeView
            onOpen={(v) => setView(v)}
            dark={dark}
            lastReports={lastReports}
          />
        )}

        {view === "tablero" && <TableroView onBack={() => setView("home")} lastReports={lastReports} />}
        {view === "reportar" && <ReportView onBack={() => setView("home")} onSubmit={enviarReporte} name={name} setName={setName} />}
        {view === "mapa" && <MapaView onBack={() => setView("home")} />}
        {view === "sugerencias" && <SugerenciasView onBack={() => setView("home")} lastReports={lastReports} />}
        {view === "settings" && <SettingsView onBack={() => setView("home")} dark={dark} setDark={setDark} />}
      </main>

      <Footer onHome={() => setView("home")} onSettings={() => setView("settings")} />
    </div>
  );
}

function Header({ dark, setDark }) {
  return (
    <header style={{ display: "flex", justifyContent: "center", alignItems: "center", gap: 12, flexDirection: "column" }}>
      <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
        <div style={{ width: 64, height: 64, borderRadius: 16, background: "linear-gradient(135deg,#a8d5a2,#4caf50)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 28, boxShadow: "0 8px 20px rgba(2,6,23,0.08)" }}>üè°</div>
        <div style={{ textAlign: "center" }}>
          <h1 style={{ margin: 0, fontSize: 24 }}>Departamento de Territorio</h1>
          <div style={{ fontSize: 13, opacity: 0.9 }}>Cuatro Plazas ‚Äî Tablero y Reportes</div>
        </div>
      </div>

      <div style={{ marginTop: 10, display: "flex", gap: 8 }}>
        <label style={{ display: "flex", alignItems: "center", gap: 8, cursor: "pointer" }}>
          <input type="checkbox" checked={dark} onChange={(e) => setDark(e.target.checked)} /> Modo oscuro
        </label>
      </div>
    </header>
  );
}

function HomeView({ onOpen, dark, lastReports }) {
  const cardStyle = {
    borderRadius: 18,
    padding: 18,
    display: "flex",
    alignItems: "center",
    gap: 14,
    boxShadow: '0 8px 30px rgba(2,6,23,0.06)',
    background: dark ? "linear-gradient(180deg,#0b3440,#09303a)" : "linear-gradient(180deg,#f6fbf6,#a8d5a2)",
    color: dark ? "#e6f7ee" : "#07202b",
    transform: 'translateZ(0)',
    transition: 'transform .18s ease, box-shadow .18s ease'
  };

  const container = {
    display: 'grid',
    gridTemplateColumns: 'repeat(auto-fit,minmax(260px,1fr))',
    gap: 18
  };

  return (
    <section>
      <div style={{ maxWidth: 1100, margin: '12px auto 20px', padding: 6 }}>
        <div style={container}>
          <button aria-label="Tablero de anuncios" style={cardStyle} onClick={() => onOpen('tablero')}> 
            <div style={{ fontSize: 34 }}>üì¢</div>
            <div style={{ textAlign: 'left' }}>
              <div style={{ fontSize: 18, fontWeight: 700 }}>Tablero de Anuncios</div>
              <div style={{ fontSize: 13, opacity: 0.85 }}>Ver avisos y novedades</div>
            </div>
          </button>

          <button aria-label="Reportar territorio" style={{ ...cardStyle, border: dark ? '2px solid rgba(255,255,255,0.06)' : '2px solid rgba(0,0,0,0.04)' }} onClick={() => onOpen('reportar')}> 
            <div style={{ fontSize: 34 }}>üìù</div>
            <div style={{ textAlign: 'left' }}>
              <div style={{ fontSize: 18, fontWeight: 700 }}>Reportar Territorio</div>
              <div style={{ fontSize: 13, opacity: 0.85 }}>Enviar manzanas predicadas</div>
            </div>
          </button>

          <button aria-label="Mapa" style={cardStyle} onClick={() => onOpen('mapa')}> 
            <div style={{ fontSize: 34 }}>üó∫Ô∏è</div>
            <div style={{ textAlign: 'left' }}>
              <div style={{ fontSize: 18, fontWeight: 700 }}>Mapa</div>
              <div style={{ fontSize: 13, opacity: 0.85 }}>Ubicar territorios (demo)</div>
            </div>
          </button>

          <button aria-label="Sugerencias" style={cardStyle} onClick={() => onOpen('sugerencias')}> 
            <div style={{ fontSize: 34 }}>‚≠ê</div>
            <div style={{ textAlign: 'left' }}>
              <div style={{ fontSize: 18, fontWeight: 700 }}>Sugerencias</div>
              <div style={{ fontSize: 13, opacity: 0.85 }}>Priorizar salidas la pr√≥xima semana</div>
            </div>
          </button>
        </div>

        <div style={{ marginTop: 22 }}>
          <h3 style={{ margin: '10px 0' }}>√öltimos reportes</h3>
          {lastReports.length === 0 && <div style={{ opacity: 0.7 }}>A√∫n no hay reportes ‚Äî aparecer√°n aqu√≠</div>}
          <ul style={{ listStyle: 'none', padding: 0, marginTop: 8 }}>
            {lastReports.map((r, i) => (
              <li key={i} style={{ padding: 10, borderRadius: 12, background: dark ? '#06282b' : '#fff', marginBottom: 8, boxShadow: '0 6px 18px rgba(2,6,23,0.04)' }}>
                <div style={{ fontWeight: 700 }}>{r.nombre}</div>
                <div style={{ fontSize: 13, opacity: 0.8 }}>{`Territorio ${r.territorio} ‚Ä¢ Manzana ${r.manzana}`}</div>
                <div style={{ fontSize: 12, opacity: 0.6 }}>{new Date(r.date).toLocaleString()}</div>
              </li>
            ))}
          </ul>
        </div>
      </div>
    </section>
  );
}

function TableroView({ onBack, lastReports }) {
  return (
    <section style={{ maxWidth: 980, margin: '0 auto' }}>
      <button onClick={onBack} style={{ marginBottom: 12, padding: 10, borderRadius: 10 }}>&larr; Volver</button>
      <h2>üìã Tablero de Anuncios</h2>
      <div style={{ marginTop: 12 }}>
        <article style={{ padding: 14, borderRadius: 12, background: '#fff', boxShadow: '0 8px 26px rgba(2,6,23,0.06)' }}>
          <h3 style={{ marginTop: 0 }}>Novedades</h3>
          <ul>
            <li>22 Nov ‚Äî Reuni√≥n de coordinaci√≥n a las 18:00</li>
            <li>20 Nov ‚Äî Cambio de rutas por lluvia</li>
          </ul>
        </article>

        <div style={{ marginTop: 14 }}>
          <h4>√öltimos reportes</h4>
          <div style={{ display: 'grid', gap: 8 }}>
            {lastReports.length === 0 && <div style={{opacity:0.7}}>Sin reportes</div>}
            {lastReports.map((r,i)=> (
              <div key={i} style={{ padding: 10, borderRadius: 10, background:'#f7fff7' }}>{`${r.nombre} ‚Ä¢ Territorio ${r.territorio} ‚Ä¢ Manzana ${r.manzana}`}</div>
            ))}
          </div>
        </div>
      </div>
    </section>
  );
}

function ReportView({ onBack, onSubmit, name, setName }) {
  const [territorio, setTerritorio] = useState(1);
  const [manzana, setManzana] = useState(1);
  return (
    <section style={{ maxWidth: 720, margin: '0 auto' }}>
      <button onClick={onBack} style={{ marginBottom: 12, padding: 10, borderRadius: 10 }}>&larr; Volver</button>
      <h2>üìù Reportar Territorio</h2>
      <div style={{ marginTop: 12, padding: 12, borderRadius: 12, background: '#fff', boxShadow: '0 8px 26px rgba(2,6,23,0.06)' }}>
        <label style={{ display:'block', marginBottom:8 }}>Territorio (1-32)
          <input type="number" min={1} max={32} value={territorio} onChange={e=>setTerritorio(e.target.value)} style={{ width:'100%', padding:10, borderRadius:10, marginTop:6 }} />
        </label>

        <label style={{ display:'block', marginBottom:8 }}>Manzana
          <input type="text" value={manzana} onChange={e=>setManzana(e.target.value)} style={{ width:'100%', padding:10, borderRadius:10, marginTop:6 }} />
        </label>

        <label style={{ display:'block', marginBottom:8 }}>Tu nombre (opcional)
          <input type="text" value={name} onChange={e=>setName(e.target.value)} placeholder="Ej: Juan" style={{ width:'100%', padding:10, borderRadius:10, marginTop:6 }} />
        </label>

        <div style={{ display:'flex', gap:10, marginTop:10 }}>
          <button onClick={()=>onSubmit({ territorio, manzana, nombre: name })} style={{ flex:1, padding:12, borderRadius:12, background:'#a8d5a2', fontWeight:700 }}>Enviar reporte</button>
          <button onClick={onBack} style={{ padding:12, borderRadius:12, background:'#fff', border:'1px solid #e6f4e6' }}>Cancelar</button>
        </div>
      </div>
    </section>
  );
}

function MapaView({ onBack }) {
  return (
    <section style={{ maxWidth: 980, margin: '0 auto' }}>
      <button onClick={onBack} style={{ marginBottom: 12, padding: 10, borderRadius: 10 }}>&larr; Volver</button>
      <h2>üó∫Ô∏è Mapa</h2>
      <div style={{ height: 320, borderRadius: 12, background: '#fff', boxShadow: '0 8px 26px rgba(2,6,23,0.06)', display:'flex', alignItems:'center', justifyContent:'center' }}>[Mapa interactivo placeholder]</div>
    </section>
  );
}

function SugerenciasView({ onBack, lastReports }) {
  // Sugerencia simple: mostrar territorios con menos reportes (demo)
  const counts = new Array(32).fill(0);
  lastReports.forEach(r => { const t = Number(r.territorio); if(!isNaN(t) && t>=1 && t<=32) counts[t-1]++ });
  const suggestionIds = counts.map((c,i)=>({id:i+1,c})).sort((a,b)=>a.c-b.c).slice(0,4).map(x=>x.id);

  return (
    <section style={{ maxWidth: 980, margin: '0 auto' }}>
      <button onClick={onBack} style={{ marginBottom: 12, padding: 10, borderRadius: 10 }}>&larr; Volver</button>
      <h2>‚≠ê Sugerencias para la pr√≥xima semana</h2>
      <ol>
        {suggestionIds.map((id)=> <li key={id}>Territorio {id}</li>)}
      </ol>
    </section>
  );
}

function SettingsView({ onBack, dark, setDark }) {
  return (
    <section style={{ maxWidth: 600, margin: '0 auto' }}>
      <button onClick={onBack} style={{ marginBottom: 12, padding: 10, borderRadius: 10 }}>&larr; Volver</button>
      <h2>‚öôÔ∏è Ajustes</h2>
      <div style={{ padding: 12, borderRadius: 12, background: '#fff', boxShadow: '0 8px 26px rgba(2,6,23,0.06)' }}>
        <div style={{ display:'flex', alignItems:'center', gap:10 }}>
          <label style={{ display:'flex', alignItems:'center', gap:8 }}>
            <input type="checkbox" checked={dark} onChange={e=>setDark(e.target.checked)} /> Modo oscuro
          </label>
        </div>
      </div>
    </section>
  );
}

function Footer({ onHome, onSettings }) {
  return (
    <footer style={{ position: 'fixed', left: 0, right: 0, bottom: 14, display: 'flex', justifyContent: 'center', gap: 12 }}>
      <button onClick={onHome} style={{ padding: 12, borderRadius: 14, background: '#fff', boxShadow: '0 8px 22px rgba(2,6,23,0.06)' }}>üè†</button>
      <button onClick={onSettings} style={{ padding: 12, borderRadius: 14, background: '#fff', boxShadow: '0 8px 22px rgba(2,6,23,0.06)' }}>‚öôÔ∏è</button>
    </footer>
  );
}

/*
  Deployment notes (quick):
  1) Create a new React app (Vite or Create React App).
  2) Put this component as src/App.jsx and export default.
  3) Install and configure Tailwind if you want to replace inline styles.
  4) For GitHub Pages: set homepage in package.json and use gh-pages package, or deploy the build folder to GitHub Pages.

  If quer√©s, te creo el repo structure y archivos listos para copiar.
*/
