<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tablero</title>
<style>
 body { margin:0; font-family:Arial, sans-serif; background:#f4f4f4; }
 header { background:#1a4b27; color:#fff; padding:16px; text-align:center; font-size:20px; font-weight:700; }
 .container { padding:16px; max-width:900px; margin:auto; }
 .top-bar { display:flex; gap:10px; margin-bottom:16px; }
 .search { flex:1; padding:10px; border-radius:8px; border:1px solid #ccc; }
 .filter { padding:10px; border-radius:8px; border:1px solid #ccc; }
 .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:16px; }
 .card { background:#fff; border-radius:12px; padding:12px; box-shadow:0 2px 6px rgba(0,0,0,0.15); position:relative; transition:transform .15s; }
 .card:hover { transform:scale(1.02); }
 .thumb { width:100%; height:160px; border-radius:8px; object-fit:cover; background:#ddd; }
 .title { font-size:16px; font-weight:700; margin:10px 0 6px; }
 .cat { display:inline-block; padding:4px 10px; border-radius:6px; color:#fff; font-size:12px; margin-bottom:8px; }
 .btn-row { display:flex; gap:6px; margin-top:10px; }
 button { flex:1; padding:8px; border:none; border-radius:8px; font-size:14px; cursor:pointer; font-weight:600; }
 .btn-prev { background:#1a73e8; color:white; }
 .btn-dl { background:#34a853; color:white; }
 .btn-wa { background:#25d366; color:white; }
 .fav { position:absolute; top:10px; right:10px; font-size:20px; cursor:pointer; }
 .menu { position:absolute; top:10px; left:10px; font-size:20px; cursor:pointer; }
 .hidden-menu { display:none; position:absolute; background:white; top:32px; left:10px; box-shadow:0 2px 6px rgba(0,0,0,0.2); border-radius:8px; z-index:10; }
 .hidden-menu div { padding:10px; cursor:pointer; border-bottom:1px solid #eee; }
 .hidden-menu div:last-child { border-bottom:none; }
 .fab { position:fixed; bottom:20px; right:20px; background:#1a73e8; color:white; width:60px; height:60px; border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:34px; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.3); }
</style>
</head>
<body>
<header>Tablero de Archivos</header>
<div class="container">
 <div class="top-bar">
   <input id="search" class="search" placeholder="Buscar..." />
   <select id="filter" class="filter">
     <option value="">Categor√≠as</option>
     <option value="Predicaci√≥n">Predicaci√≥n</option>
     <option value="Reuniones">Reuniones</option>
     <option value="Documentos">Documentos</option>
   </select>
 </div>
 <div id="grid" class="grid"></div>
</div>
<div class="fab" id="addBtn">+</div>
<script type="module">
import { db, ref as dbRef, onValue } from "./firebase.js";
const grid = document.getElementById("grid");
const search = document.getElementById("search");
const filter = document.getElementById("filter");
const addBtn = document.getElementById("addBtn");
const filesRef = dbRef(db, "drive_archivos");
let all = [];
function thumb(url){
 if(url.includes("drive.google.com")) return `https://drive.google.com/thumbnail?sz=w320&id=${url.split("d/")[1]?.split("/")[0]}`;
 return "https://via.placeholder.com/300x200?text=Vista";
}
function render(){
 const q = search.value.toLowerCase();
 const f = filter.value;
 grid.innerHTML = "";
 all.filter(x=>{
   const okCat = f=="" || x.categoria===f;
   const okTxt = x.titulo.toLowerCase().includes(q);
   return okCat && okTxt;
 }).forEach(x=>{
   const card = document.createElement("div");
   card.className = "card";
   card.innerHTML = `
     <div class="menu">‚ãÆ</div>
     <div class="hidden-menu">
       <div class="edit">‚úèÔ∏è Editar</div>
       <div class="delete">üóëÔ∏è Eliminar</div>
     </div>
     <div class="fav">${x.fav?"‚òÖ":"‚òÜ"}</div>
     <img class="thumb" src="${thumb(x.url)}" />
     <div class="cat" style="background:${x.color}">${x.categoria}</div>
     <div class="title">${x.titulo}</div>
     <div class="btn-row">
       <button class="btn-prev">Vista previa</button>
       <button class="btn-dl">Descargar</button>
       <button class="btn-wa">WhatsApp</button>
     </div>`;
   card.querySelector(".btn-prev").onclick=()=>window.open(x.url,"_blank");
   card.querySelector(".btn-dl").onclick=()=>window.open(x.url,"_blank");
   card.querySelector(".btn-wa").onclick=()=>window.open(`https://wa.me/?text=${encodeURIComponent(x.url)}`);
   card.querySelector(".fav").onclick=()=>{};
   card.querySelector(".menu").onclick=()=>{
     const m = card.querySelector(".hidden-menu");
     m.style.display = m.style.display=="block"?"none":"block";
   };
   grid.appendChild(card);
 });
}
onValue(filesRef,s=>{
 all=[];
 s.forEach(ch=>all.push(ch.val()));
 render();
});
search.oninput=render;
filter.onchange=render;
addBtn.onclick=()=>location.href="subir.html";
</script>
</body>
</html>
