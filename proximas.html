<script type="module">
import { db, ref, onValue } from "./firebase.js";

const lista = document.getElementById("listaPendientes");

try {

  const reportesRef = ref(db, "reportes");

  onValue(reportesRef, (snap) => {
    lista.innerHTML = "";
    const datos = snap.val();

    if (!datos) {
      lista.innerHTML = "<p style='color:#666'>No hay reportes cargados.</p>";
      return;
    }

    let hayPendientes = false;

    Object.values(datos).forEach(reporte => {

      if (reporte.pendientes && reporte.pendientes.length > 0) {

        hayPendientes = true;

        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
          <div><strong>Territorio ${reporte.territorio || "-"}</strong></div>
          <div>Pendientes:
            <span class="pend">${reporte.pendientes.join(", ")}</span>
          </div>
          <div>Conductor: ${reporte.conductor || "-"}</div>
          <div>Fecha: ${reporte.fecha || "-"}</div>
        `;

        lista.appendChild(card);
      }

    });

    if (!hayPendientes) {
      lista.innerHTML = "<p style='color:#666'>No hay territorios pendientes.</p>";
    }

  });

} catch (e) {

  lista.innerHTML = `
    <div class="card">
      <strong>Error de carga</strong><br>
      No se pudo leer Firebase.<br><br>
      Revisá:<br>
      • archivo firebase.js<br>
      • ruta correcta (./firebase.js)<br>
      • consola del navegador
    </div>
  `;

  console.error("Error en próximas salidas:", e);
}
</script>