<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PrÃ³ximas Salidas</title>

<style>
:root{--verde:#1a4b27;--bg:#f4f4f4}
body{margin:0;font-family:Arial;background:var(--bg)}
header{background:var(--verde);color:white;padding:18px;text-align:center;font-size:20px}
.container{max-width:900px;margin:auto;padding:15px}

.card{
  background:white;
  padding:16px;
  border-radius:14px;
  margin-bottom:14px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
  border-left:8px solid var(--verde);
}

.fecha{
  font-size:22px;
  font-weight:bold;
  margin-bottom:6px;
}

.linea{
  font-size:17px;
  margin:4px 0;
}

.back{
  position:fixed;
  bottom:15px;
  left:15px;
  background:var(--verde);
  color:white;
  border:none;
  padding:10px 14px;
  border-radius:10px;
  cursor:pointer;
}
</style>
</head>

<body>

<header>ğŸ“… PrÃ³ximas Salidas</header>

<div class="container" id="lista"></div>

<button class="back" onclick="location.href='index.html'">â¬… Inicio</button>

<script type="module">
import { db, ref as dbRef, onValue } from "./firebase.js";

const lista = document.getElementById("lista");
const salidasRef = dbRef(db,"salidas_asignadas");

// FORMATO FECHA SIMPLE
function mostrarFecha(fecha){
  try{
    return new Date(fecha).toLocaleDateString("es-AR",{weekday:'long',day:'numeric',month:'long'}).toUpperCase();
  }catch{
    return fecha;
  }
}

// ESCUCHAR FIREBASE SIN FILTROS
onValue(salidasRef, snap => {

  lista.innerHTML="";

  if(!snap.exists()){
    lista.innerHTML="<p align='center'>No hay salidas asignadas</p>";
    return;
  }

  let salidas = [];

  snap.forEach(x=>{
    salidas.push({
      id: x.key,
      ...x.val()
    });
  });

  // ORDENAR POR FECHA TEXTO (NO FALLA)
  salidas.sort((a,b)=>{
    return String(a.fecha).localeCompare(String(b.fecha));
  });

  salidas.forEach(o=>{

    const card=document.createElement("div");
    card.className="card";

    card.innerHTML=`
      <div class="fecha">ğŸ•’ ${mostrarFecha(o.fecha)} - ${o.hora || "â€”"}</div>
      <div class="linea">ğŸ“ Territorio: <b>${o.territorio}</b></div>
      <div class="linea">ğŸ‘¤ Conductor: ${o.conductor || "â€”"}</div>
      <div class="linea">ğŸ“Œ DirecciÃ³n: ${o.calle || "â€”"} y ${o.interseccion || "â€”"}</div>
      <div class="linea">ğŸ§± Faltan: ${(o.pendientes || []).join(", ") || "Nadie"}</div>
      ${o.observaciones ? `<div class="linea">âœ ${o.observaciones}</div>` : ""}
    `;

    lista.appendChild(card);

  });

});
</script>

</body>
</html>